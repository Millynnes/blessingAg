from datetime import datetime
import random

def calculate_fortune(birthday):
    birth_date = datetime.strptime(birthday, '%Y-%m-%d')

    # 使用生日作为随机种子，确保同一个生日产生相同的结果
    seed = int(birth_date.strftime('%Y%m%d'))
    random.seed(seed)

    # Chinese zodiac animals and their relationships
    zodiac = ['鼠', '牛', '虎', '兔', '龙', '蛇', '马', '羊', '猴', '鸡', '狗', '猪']
    elements = ['木', '火', '土', '金', '水']

    # 生肖相配关系
    zodiac_compatibility = {
        '鼠': ['龙', '猴'],
        '牛': ['蛇', '鸡'],
        '虎': ['猪', '马'],
        '兔': ['狗', '羊'],
        '龙': ['鼠', '猴'],
        '蛇': ['牛', '鸡'],
        '马': ['虎', '羊'],
        '羊': ['兔', '马'],
        '猴': ['龙', '鼠'],
        '鸡': ['蛇', '牛'],
        '狗': ['兔', '虎'],
        '猪': ['虎', '羊']
    }

    # 五行属性详细解析
    element_details = {
        '木': '木主东方，代表生长、升发。性格仁慈，富有同情心。2025年木运势平稳，适合发展人际关系。',
        '火': '火主南方，代表温暖、光明。性格热情，充满活力。2025年火运强盛，事业有望突破。',
        '土': '土主中央，代表稳重、包容。性格踏实，为人诚恳。2025年土运渐长，适合稳扎稳打。',
        '金': '金主西方，代表坚强、果断。性格正直，做事有条理。2025年金运走高，财运亨通。',
        '水': '水主北方，代表智慧、灵活。性格聪慧，适应力强。2025年水运流畅，学习进取有成。'
    }

    # 月份运势预测
    monthly_fortunes = {
        '1月': '新年伊始，开运顺遂。宜：开展新计划，建立新关系。忌：急于求成。',
        '2月': '贵人助力，人缘良好。宜：社交活动，寻求合作。忌：独断专行。',
        '3月': '春意盎然，生机勃发。宜：升职加薪，表达心意。忌：贪功冒进。',
        '4月': '机遇频现，需谨慎把握。宜：投资理财，拓展人脉。忌：轻信他人。',
        '5月': '事业有成，桃花旺盛。宜：表现才能，把握姻缘。忌：优柔寡断。',
        '6月': '财运亨通，口碑载道。宜：扩大规模，宣传推广。忌：铺张浪费。',
        '7月': '事业稳定，感情和睦。宜：稳固根基，维系感情。忌：剑走偏锋。',
        '8月': '贵人相助，财运亨通。宜：把握机会，大胆投资。忌：因小失大。',
        '9月': '成果显著，收获颇丰。宜：总结经验，答谢贵人。忌：骄傲自满。',
        '10月': '转型升级，革新创新。宜：学习进修，开拓创新。忌：固步自封。',
        '11月': '稳中求进，和谐发展。宜：深化关系，稳固基础。忌：急于求成。',
        '12月': '岁末圆满，展望未来。宜：规划来年，答谢恩情。忌：妄下定论。'
    }

    # 获取生肖和五行
    year = birth_date.year
    zodiac_index = (year - 1900) % 12
    element_index = ((year - 1900) % 10) // 2

    my_zodiac = zodiac[zodiac_index]
    my_element = elements[element_index]

    # 幸运数字和颜色
    lucky_numbers = [random.randint(1, 9) for _ in range(3)]
    colors = ['红色', '黄色', '蓝色', '绿色', '紫色', '白色', '金色']
    lucky_colors = random.sample(colors, 2)

    # 运势类别详细预测
    career_fortunes = [
        '2025年事业运势大好，尤其在3月至5月期间有望获得升职加薪机会。建议：1. 积极参与团队项目，展现领导才能；2. 注重专业技能提升，参加相关培训；3. 与上级保持良好沟通，争取更多发展机会。下半年将遇到贵人相助，事业更上一层楼。',
        '2025年工作中将遇到关键性机遇，特别是在7月至9月间。建议：1. 合理规划职业发展路径；2. 扩展人际关系网络；3. 把握市场动向，适时调整策略。年底有望获得意外惊喜。',
        '2025年适合尝试新的职业方向，尤其是在1月至3月期间。建议：1. 关注新兴行业发展；2. 做好职业规划，适度调整；3. 保持学习心态，提升核心竞争力。年中可能出现转折点。',
        '2025年事业发展稳中有进，下半年特别顺利。建议：1. 稳固已有成果；2. 培养团队协作能力；3. 注意工作与生活平衡。全年整体呈上升趋势。'
    ]

    love_fortunes = [
        '2025年感情运势喜人，春季桃花运特别旺盛。单身者有望遇到心仪对象，建议：1. 多参加社交活动；2. 保持开放心态；3. 适时表达真诚。已婚者感情更加稳定，可考虑计划家庭新成员。',
        '2025年感情生活平稳发展，夏季可能迎来转机。建议：1. 用心经营感情；2. 增进沟通理解；3. 策划浪漫约会。年底有望修成正果。',
        '2025年感情需要更多用心维护，秋季是感情转折点。建议：1. 保持耐心和信任；2. 创造共同话题；3. 注意情绪管理。年中可能经历考验但终有圆满。',
        '2025年桃花运渐入佳境，冬季特别适合发展感情。建议：1. 把握缘分机会；2. 展现真实自我；3. 维护感情和谐。全年感情运势稳定上升。'
    ]

    health_fortunes = [
        '2025年身体状况良好，春季尤其精力充沛。建议：1. 坚持运动习惯；2. 保持作息规律；3. 注意饮食均衡。全年免疫力较强，但仍需注意秋季保暖。',
        '2025年健康运势平稳，需要在夏季特别注意。建议：1. 规律体检；2. 适量运动；3. 调节作息。年底前后要特别注意休息。',
        '2025年身心健康较好，但秋季需要调养。建议：1. 增强体质锻炼；2. 保持心情愉悦；3. 合理膳食搭配。年中可能有小病困扰，及时就医。',
        '2025年整体健康状况稳定，冬季需要额外关注。建议：1. 坚持运动习惯；2. 注意作息规律；3. 保持心态平和。全年应重视预防保健。'
    ]

    wealth_fortunes = [
        '2025年财运亨通，上半年特别顺遂。建议：1. 把握投资机会；2. 合理规划支出；3. 注意风险防范。年中可能有意外收获。',
        '2025年理财机会良多，中期最为有利。建议：1. 稳健投资；2. 开源节流；3. 适度储蓄。年底财运大好。',
        '2025年财源广进，下半年表现突出。建议：1. 做好理财规划；2. 控制支出；3. 寻找副业机会。全年财运平稳向上。',
        '2025年理财有道，收入稳定增长。建议：1. 优化投资组合；2. 把握市场机遇；3. 注意风险控制。年末有望收获颇丰。'
    ]

    return {
        'zodiac': my_zodiac,
        'element': my_element,
        'element_detail': element_details[my_element],
        'compatible_zodiacs': zodiac_compatibility[my_zodiac],
        'lucky_numbers': lucky_numbers,
        'lucky_colors': lucky_colors,
        'year': 2025,
        'monthly_fortunes': monthly_fortunes,
        'career': random.choice(career_fortunes),
        'love': random.choice(love_fortunes),
        'health': random.choice(health_fortunes),
        'wealth': random.choice(wealth_fortunes)
    }